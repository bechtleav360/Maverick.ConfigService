ARG servicename=Bechtle.A365.ConfigService
FROM mcr.microsoft.com/dotnet/core/runtime:2.2 AS base
FROM localhost:5000/configservice_base AS configservice_build
ARG servicename

FROM localhost:5000/configservice_base AS configservice_migrate_build
ARG servicename
RUN dotnet restore src/${servicename}.Cli/${servicename}.Cli.csproj --packages /src/packages
RUN dotnet build src/${servicename}.Cli/${servicename}.Cli.csproj -c Release -o /app/configservice_migrate_build --no-restore
RUN dotnet publish src/${servicename}.Cli/${servicename}.Cli.csproj -c Release -o /app/configservice_migrate_build --no-restore
FROM base AS configservice_migrate
WORKDIR /app/configservice_migrate
COPY --from=configservice_migrate_build /app/configservice_migrate_build /app/configservice_migrate
CMD dotnet Bechtle.A365.ConfigService.Cli.dll migrate -c "Server=sql02;Database=DOCKER_A365ConfigProjection;User Id=sa;Password=1;"