ARG servicename=Bechtle.A365.ConfigService
FROM mcr.microsoft.com/dotnet/core/runtime:2.2 AS base
FROM localhost:5000/configservice_base AS configservice_build
ARG servicename

FROM localhost:5000/configservice_base AS configservice_projection_build
ARG servicename
RUN dotnet restore src/${servicename}.Projection/${servicename}.Projection.csproj --packages /src/packages
RUN dotnet build src/${servicename}.Projection/${servicename}.Projection.csproj -c Release -o /app/configservice_projection_build --no-restore
RUN dotnet publish src/${servicename}.Projection/${servicename}.Projection.csproj -c Release -o /app/configservice_projection_build --no-restore
FROM base AS configservice_projection
WORKDIR /app/configservice_projection
COPY --from=configservice_projection_build /app/configservice_projection_build /app/configservice_projection 
RUN sed -i 's/\r$//' startup.sh && chmod +x startup.sh
ENTRYPOINT sh startup.sh