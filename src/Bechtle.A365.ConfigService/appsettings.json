{
  "Logging": {
    "LogLevel": {
      "Default": "Trace",
      "Microsoft": "Trace"
    }
  },
  "AllowedHosts": "*",
  "Authentication": {
    "Kestrel": {
      "Enabled": false,
      "Certificate": "",
      "IpAddress": "",
      "Password": "",
      "Port": 5001
    }
  },
  "EnableLegacyRedirect": false,
  "Protection": {
    "Enabled": false
  },
  "EventBusConnection": {
    "Server": "",
    "Hub": "EventBus"
  },
  "EventStoreConnection": {
    "ConnectionName": "ConfigService",
    "Uri": "",
    "Stream": "ConfigStream"
  },
  "MemoryCache": {
    "Redis": {
      "ConnectionString": ""
    },
    "Local": {
      "Duration": "00:30:00",
      "SizeLimitInMb": 1024,
      "CompactionPercentage": 0.10
    }
  },
  "SnapshotConfiguration": {
    "Triggers": {
      "ControllerRoute": {
        "Type": "HttpRest"
      },
      "EventLagUntilComplete": {
        "Type": "EventLag",
        "Trigger": {
          "Max": 100
        }
      },
      "DailyCompleteSnapshots": {
        "Type": "Timer",
        "Trigger": {
          "Interval": "20 4 * * 1-5"
        }
      }
    },
    "Snapshots": {
      "Complete": [
        "ControllerRoute"
      ]
    },
    "Stores": {
      "Void": {
        "Enabled": false
      },
      "Local": {
        "Enabled": false,
        "ConnectionString": "Data Source=.\\snapshots.db;"
      },
      "Postgres": {
        "Enabled": false,
        "ConnectionString": ""
      },
      "MsSql": {
        "Enabled": false,
        "ConnectionString": ""
      },
      "Oracle": {
        "Enabled": false,
        "ConnectionString": "" 
      },
      "Arango": {
        "Enabled": false,
        "Uri": "",
        "User": "",
        "Password": "",
        "CreateCollection": true,
        "Collection": {
          "name": "ConfigSnapshots",
          "type": 2,
          "waitForSync": false,
          "doCompact": true,
          "isVolatile": false,
          "numberOfShards": 1,
          "keyOptions": {
            "allowUserKeys": false,
            "type": "uuid"
          }
        }
      }
    }
  },
  "LoggingConfiguration": {
    "Logging": {
      "NLog": {
        "IncludeScopes": false,
        "ParseMessageTemplates": true,
        "CaptureMessageProperties": true
      }
    },
    "NLog": {
      "autoreload": true,
      "internalLogLevel": "Off",
      "internalLogFile": "n.log",
      "throwConfigExceptions": false,
      "variables": {
        "LogLayout": "${longdate} | ${level:padding=-5} | ${logger} | ${aspnet-item:variable=CorrelationId} | ${aspnet-request-ip} | ${message} | ${exception:format=ToString:innerFormat=ToString:maxInnerExceptionLevel=10}",
        "ServiceName": "Bechtle.A365.ConfigService",
        "LogFileLocation": "logs/",
        "RabbitMqHost": "",
        "RabbitMqUser": "",
        "RabbitMqPassword": "",
        "RabbitMqPort": "0"
      },
      "extensions": [
        {
          "assembly": "NLog.Web.AspNetCore"
        },
        {
          "assembly": "NLog.RabbitMQ.Target"
        }
      ],
      "targets": {
        "rabbitmq": {
          "type": "AsyncWrapper",
          "target": {
            "type": "RabbitMQ",
            "layout": "${message}",
            "appId": "${ServiceName}",
            "topic": "${ServiceName}.{0}",
            "username": "${RabbitMqUser}",
            "password": "${RabbitMqPassword}",
            "hostname": "${RabbitMqHost}",
            "exchange": "A365.Logging",
            "port": "${RabbitMqPort}",
            "useJson": true,
            "useLayoutAsMessage": true,
            "deliveryMode": "Persistent",
            "fields": [
              {
                "key": "exception",
                "name": "exception",
                "layout": "${exception:format=ToString:innerFormat=ToString:maxInnerExceptionLevel=10}"
              },
              {
                "key": "correlationId",
                "name": "correlationId",
                "layout": "${aspnet-item:variable=CorrelationId}"
              },
              {
                "key": "logger",
                "name": "logger",
                "layout": "${logger}"
              },
              {
                "key": "logLevel",
                "name": "logLevel",
                "layout": "${level}"
              },
              {
                "key": "requestIp",
                "name": "requestIp",
                "layout": "${aspnet-request-ip}"
              },
              {
                "key": "service",
                "name": "service",
                "layout": "${ServiceName}"
              }
            ]
          }
        },
        "console": {
          "type": "AsyncWrapper",
          "target": {
            "wrapperConsole": {
              "type": "ColoredConsole",
              "layout": "${LogLayout}"
            }
          }
        },
        "file": {
          "type": "AsyncWrapper",
          "target": {
            "wrappedFile": {
              "type": "File",
              "maxArchiveFiles": 30,
              "archiveFileName": "${LogFileLocation}/{#}.log",
              "archiveAboveSize": 10485760,
              "archiveEvery": "Day",
              "archiveNumbering": "DateAndSequence",
              "archiveDateFormat": "yyyy-MM-dd",
              "fileName": "${LogFileLocation}/current.log",
              "layout": "${LogLayout}"
            }
          }
        }
      },
      "rules": [
        {
          "logger": "App.Metrics.*",
          "levels": "Trace",
          "final": true
        },
        {
          "logger": "*",
          "minLevel": "Trace",
          "writeTo": "rabbitmq"
        },
        {
          "logger": "*",
          "minLevel": "Trace",
          "writeTo": "file"
        },
        /*{
          "logger": "Microsoft.EntityFrameworkCore.*",
          "levels": "Trace, Debug, Info",
          "final": true
        },*/
        {
          "logger": "*",
          "minLevel": "Info",
          "writeTo": "console"
        }
      ]
    }
  }
}